---
import Layout from "src/layouts/Layout.astro";
import MiCuenta from "./components/MiCuenta"

---


<Layout>
  <div class="min-h-full w-full">
    <aside class="fixed top-16 inset-y-0 left-0 h-screen w-64 bg-linear-to-b from-sky-100 via-sky-100 via-sky-100 via-white/85 via-white/70 to-white/65 shadow-lg ">
      <div class="p-4  bg-linear-to-b from-sky-400 via-sky-300 to-sky-100 flex flex-col items-center space-y-2 mb-2">
        <div class="w-full flex justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-14 h-14" viewBox="0 0 24 24">
            <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
              <path d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2s10 4.477 10 10" />
              <path d="M14.75 9.5a2.75 2.75 0 1 1-5.5 0a2.75 2.75 0 0 1 5.5 0M5.5 19l.56-.98a5 5 0 0 1 4.342-2.52h3.196a5 5 0 0 1 4.342 2.52l.56.98" />
            </g>
          </svg>
        </div>

        <div class="w-full flex flex-col items-center space-y-1">
          <h2 id="name-aside" class="text-lg text-gray-800 font-semibold"></h2>
          <p id="email-aside" class="text-sm text-gray-700"></p>
        </div>
      </div>
      

      <div class="h-full w-full flex flex-col p-4 space-y-2">
        <button
          type="button"
          id="mi-cuenta"
          onclick="handleOption(0)"
          class="flex items-center space-x-2 px-3 py-2 rounded-xl text-gray-700 hover:bg-white/50 hover:shadow-md duration-300 transformation-all cursor-pointer"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24">
            <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6.578 15.482c-1.415.842-5.125 2.562-2.865 4.715C4.816 21.248 6.045 22 7.59 22h8.818c1.546 0 2.775-.752 3.878-1.803c2.26-2.153-1.45-3.873-2.865-4.715a10.66 10.66 0 0 0-10.844 0M16.5 6.5a4.5 4.5 0 1 1-9 0a4.5 4.5 0 0 1 9 0" />
          </svg>
          <span>Mi cuenta</span>
        </button>

        <button
          type="button"
          id="mis-solicitudes"
          onclick="handleOption(1)"
          class="flex items-center space-x-2 px-3 py-2 rounded-xl text-gray-700 hover:bg-white/50 hover:shadow-md duration-300 transformation-all cursor-pointer"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24">
            <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
              <path d="M3.5 3.978A1.99 1.99 0 0 1 5.5 2c1.105 0 2 .886 2 1.978c0 .394-.116.76-.317 1.069C6.585 5.966 5.5 6.842 5.5 7.934v.495M5.5 11h.012M10.5 2h2.273c3.26 0 4.892 0 6.024.798c.324.228.612.5.855.805c.848 1.066.848 2.6.848 5.67v2.545c0 2.963 0 4.445-.469 5.628c-.754 1.903-2.348 3.403-4.37 4.113c-1.257.441-2.83.441-5.98.441c-1.798 0-2.698 0-3.416-.252c-1.155-.406-2.066-1.263-2.497-2.35c-.268-.676-.268-1.523-.268-3.216V14" />
              <path d="M20.5 12a3.333 3.333 0 0 1-3.333 3.333c-.666 0-1.451-.116-2.098.057a1.67 1.67 0 0 0-1.179 1.179c-.173.647-.057 1.432-.057 2.098A3.333 3.333 0 0 1 10.5 22" />
            </g>
          </svg>
          <span>Mis solicitudes</span>
        </button>
      </div>
    </aside>

    <main class="max-h-screen w-full pl-74 p-8">
      <div id="mi-cuenta-container" class="h-full w-full hidden">
        <MiCuenta client:load/>
      </div>

      <div id="mis-solicitudes-container" class="h-full w-full">
        <div class="w-full h-screen bg-white/50"></div>
      </div>
    </main>
  </div>
</Layout>

<script>
  import { getCurrentUser } from "src/api/auth";

  document.addEventListener('DOMContentLoaded', async () => {
    const user = await getCurrentUser();

    if (user) {
      const nombreElement = document.getElementById('name-aside') as HTMLHeadElement;
      const emailElement = document.getElementById('email-aside') as HTMLParagraphElement;
      
      if (nombreElement) nombreElement.innerText = `${user.nombre} ${user.apellido}` || '';
      if (emailElement) emailElement.innerText = user.email || '';
    }
  });
</script>

<script>
  declare global {
    interface Window {
      handleOption: (numberOption: number) => void;
    }
  }

  document.addEventListener('DOMContentLoaded', async () => {
    const miCuentaButton = document.getElementById('mi-cuenta') as HTMLButtonElement;
    const misSolicitudesButton = document.getElementById('mis-solicitudes') as HTMLButtonElement;

    const misSolicitudesContainerElement = document.getElementById('mis-solicitudes-container') as HTMLDivElement;
    const miCuentaContainerElement = document.getElementById('mi-cuenta-container') as HTMLDivElement;


    window.handleOption = function (numberOption: number) {
      if (numberOption === 0) {
        miCuentaButton.style.backgroundColor = '#FFF'
        misSolicitudesButton.style.backgroundColor = 'transparent'

        misSolicitudesContainerElement.classList.add('hidden')
        miCuentaContainerElement.classList.remove('hidden')
      } else if (numberOption === 1) {
        misSolicitudesButton.style.backgroundColor = '#FFF'
        miCuentaButton.style.backgroundColor = 'transparent'

        misSolicitudesContainerElement.classList.remove('hidden')
        miCuentaContainerElement.classList.add('hidden')
      }
    }

    //Inicializacion de handleOption
    window.handleOption(0)
  });
</script>